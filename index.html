<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø·Ù„Ø¨ Ø¨Ø­Ø« Ø°ÙƒÙŠØ©</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --main-color: #2a9d8f; --error-color: #e76f51; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--tg-theme-bg-color, #f4f6f8);
            color: var(--tg-theme-text-color, #000);
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
        }
        .container {
            width: 100%; max-width: 400px;
            background: var(--tg-theme-secondary-bg-color, #fff);
            padding: 25px; border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        h2 { text-align: center; color: var(--main-color); margin-bottom: 25px; font-weight: 800; }
        label { display: block; margin: 15px 0 8px; font-weight: 600; font-size: 14px; }
        input, select {
            width: 100%; padding: 14px;
            border: 2px solid #eee; border-radius: 10px;
            box-sizing: border-box; background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000); font-size: 15px; transition: 0.3s;
        }
        input:focus, select:focus { border-color: var(--main-color); outline: none; }
        input.error { border-color: var(--error-color); animation: shake 0.3s; }
        .error-msg { color: var(--error-color); font-size: 12px; display: none; margin-top: 5px; }
        .btn {
            background-color: var(--main-color); color: white;
            border: none; padding: 16px; width: 100%;
            border-radius: 12px; font-size: 18px; cursor: pointer;
            margin-top: 30px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(42, 157, 143, 0.3);
        }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“„ Ø·Ù„Ø¨ Ø¨Ø­Ø« Ø¬Ø§Ù…Ø¹ÙŠ</h2>
    
    <label>ğŸ“ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙˆØ§Ù„ØªØ®ØµØµ</label>
    <select id="level">
        <option value="Ø³Ù†Ø© Ø£ÙˆÙ„Ù‰ Ø­Ù‚ÙˆÙ‚">Ø³Ù†Ø© Ø£ÙˆÙ„Ù‰ Ø­Ù‚ÙˆÙ‚</option>
        <option value="Ø³Ù†Ø© Ø«Ø§Ù†ÙŠØ© Ø­Ù‚ÙˆÙ‚">Ø³Ù†Ø© Ø«Ø§Ù†ÙŠØ© Ø­Ù‚ÙˆÙ‚</option>
        <option value="Ø³Ù†Ø© Ø«Ø§Ù„Ø«Ø© (Ù‚Ø§Ù†ÙˆÙ† Ø®Ø§Øµ)">Ø³Ù†Ø© Ø«Ø§Ù„Ø«Ø© (Ù‚Ø§Ù†ÙˆÙ† Ø®Ø§Øµ)</option>
        <option value="Ø³Ù†Ø© Ø«Ø§Ù„Ø«Ø© (Ù‚Ø§Ù†ÙˆÙ† Ø¹Ø§Ù…)">Ø³Ù†Ø© Ø«Ø§Ù„Ø«Ø© (Ù‚Ø§Ù†ÙˆÙ† Ø¹Ø§Ù…)</option>
    </select>

    <label>ğŸ“˜ Ø§Ø³Ù… Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ (Ø§Ù„Ù…Ø§Ø¯Ø©)</label>
    <input type="text" id="module" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ">
    <div class="error-msg" id="err-module">ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</div>

    <label>ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø«</label>
    <input type="text" id="title" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø« ÙƒØ§Ù…Ù„Ø§Ù‹">
    <div class="error-msg" id="err-title">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹ Ø£Ùˆ ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…</div>

    <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨</label>
    <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨">
    <div class="error-msg" id="err-name">ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨ (Ø­Ø±ÙˆÙ ÙÙ‚Ø·)</div>

    <label>ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
    <input type="tel" id="phone" placeholder="06xxxxxxxx" maxlength="10">
    <div class="error-msg" id="err-phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05/06/07)</div>

    <label>ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label>
    <input type="text" id="wilaya" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆÙ„Ø§ÙŠØ©">
    <div class="error-msg" id="err-wilaya">Ø§Ø³Ù… Ø§Ù„ÙˆÙ„Ø§ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­</div>

    <label>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
    <input type="date" id="date">
    <div class="error-msg" id="err-date">Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ù†Ø·Ù‚ÙŠ (Ù‚Ø¯ÙŠÙ… Ø£Ùˆ Ø¨Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹)</div>

    <label>ğŸ’¡ Ø®Ø¯Ù…Ø© Ø¥Ø¶Ø§ÙÙŠØ©</label>
    <select id="feature">
        <option value="Ù„Ø§ØŒ Ø¨Ø­Ø« ÙÙ‚Ø·">Ù„Ø§ØŒ Ø¨Ø­Ø« ÙÙ‚Ø·</option>
        <option value="Ù†Ø¹Ù…ØŒ Ø£Ø±ÙŠØ¯ Ø´Ø±Ø­ Ø¬Ø²Ø¦ÙŠØ§Øª">Ù†Ø¹Ù…ØŒ Ø£Ø±ÙŠØ¯ Ø´Ø±Ø­ Ø¬Ø²Ø¦ÙŠØ§Øª</option>
    </select>

    <button class="btn" onclick="validateAndSend()">âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø°ÙƒÙŠØ© Ù„Ù„ØªØ§Ø±ÙŠØ® (Ù…Ù†Ø¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ ÙˆÙ…Ù†Ø¹ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¨Ø¹ÙŠØ¯)
    const dateInput = document.getElementById('date');
    const today = new Date();
    const nextYear = new Date();
    nextYear.setFullYear(today.getFullYear() + 1);

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ÙŠÙƒÙˆÙ† Ù…Ù‚Ø¨ÙˆÙ„Ø§Ù‹ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (YYYY-MM-DD)
    const formatDate = (d) => d.toISOString().split('T')[0];
    
    dateInput.min = formatDate(today); // Ù„Ø§ ÙŠÙ‚Ø¨Ù„ Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„ÙŠÙˆÙ…
    dateInput.max = formatDate(nextYear); // Ù„Ø§ ÙŠÙ‚Ø¨Ù„ Ø£ÙƒØ«Ø± Ù…Ù† Ø³Ù†Ø© Ù‚Ø¯Ø§Ù…
    dateInput.value = formatDate(today); // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù‡ÙŠ Ø§Ù„ÙŠÙˆÙ…

    function showError(id, show) {
        document.getElementById(id).style.display = show ? 'block' : 'none';
        document.getElementById(id.replace('err-', '')).classList.toggle('error', show);
        return !show; // ÙŠØ±Ø¬Ø¹ false Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£
    }

    function validateAndSend() {
        let valid = true;

        // Ø¬Ù„Ø¨ Ø§Ù„Ù‚ÙŠÙ…
        let level = document.getElementById("level").value;
        let module = document.getElementById("module").value.trim();
        let title = document.getElementById("title").value.trim();
        let name = document.getElementById("name").value.trim();
        let phone = document.getElementById("phone").value.trim();
        let wilaya = document.getElementById("wilaya").value.trim();
        let dateVal = document.getElementById("date").value;
        let feature = document.getElementById("feature").value;

        // ğŸ§  1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… (Ø­Ø±ÙˆÙ ÙÙ‚Ø·ØŒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙƒÙ„Ù…ØªÙŠÙ† Ø£Ùˆ 4 Ø£Ø­Ø±Ù)
        // Ø§Ù„Ø±ÙŠØ¬ÙŠÙƒØ³: ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§ØªØŒ ÙŠØ±ÙØ¶ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ù…ÙˆØ²
        let nameRegex = /^[\u0600-\u06FFa-zA-Z\s]{4,}$/;
        if (!nameRegex.test(name) || name.length < 4 || name === ".") 
            valid = showError('err-name', true) && valid;
        else showError('err-name', false);

        // ğŸ§  2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ (Ø¬Ø²Ø§Ø¦Ø±ÙŠ 10 Ø£Ø±Ù‚Ø§Ù…)
        let phoneRegex = /^(05|06|07)[0-9]{8}$/;
        if (!phoneRegex.test(phone)) 
            valid = showError('err-phone', true) && valid;
        else showError('err-phone', false);

        // ğŸ§  3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚ÙŠØ§Ø³ (Ø§Ù„Ø·ÙˆÙ„)
        if (module.length < 3) valid = showError('err-module', true) && valid; else showError('err-module', false);
        if (title.length < 5) valid = showError('err-title', true) && valid; else showError('err-title', false);
        if (wilaya.length < 3) valid = showError('err-wilaya', true) && valid; else showError('err-wilaya', false);

        // ğŸ§  4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù„Ù„ØªØ£ÙƒØ¯ ÙÙ‚Ø·)
        let selectedDate = new Date(dateVal);
        let minDate = new Date(dateInput.min);
        if (selectedDate < minDate) 
            valid = showError('err-date', true) && valid;
        else showError('err-date', false);

        if (valid) {
            let data = {
                level: level,
                module: module,
                title: title,
                name: name,
                phone: phone,
                wilaya: wilaya,
                date: dateVal,
                feature: feature
            };
            tg.sendData(JSON.stringify(data));
        } else {
            tg.HapticFeedback.notificationOccurred('error'); // Ø§Ù‡ØªØ²Ø§Ø² Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
        }
    }
</script>

</body>
</html>
